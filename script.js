const config1 = {
    "album": {
        "title": "cyber out",
        "artist": "эмси б4мжиха",
        "year": "2026",
        "genre": "Электронная музыка",
        "cover": "oblojka.jpg",
        "description": "Первый альбом созданный эмси б4мжихой. Это не настоящий рэпер а искусственный! И этот сайт - единственный, где можно прослушать альбом."
    },
    "tracks": [
        {
            "id": 1,
            "title": "чсп",
            "artist": "эмси б4мжиха",
            "duration": "1:14",
            "audio": "ЧСП.mp3",
            "lyrics": "[Intro]\nOk, go!\n\n[Verse]\nКодер спилил лондона, а лондон спилил кодера\nи он даже не понял как он трахнул ту нулёвку (кид) бля\nэта шлюха на вид будто не выросший перец\nно и на сервере пиздец зовите меня младенец\nна рдсе кучу скама, кодер заебись уже\nда хватит ты дрожать как будто сталин спиздил полицей\nда гашенный ташкент маршаффер разьебет вашу контору сука с.. эмси тамарой! (Нахуй)\n\n[Verse 2]\nПердолил малолеток но ты не сидел в тюрьме\nда кодер жарит сук, не лондон тот который в облаке\nбля лондон просто заебался сидит курит и тупеет\nи ебланом называется теперь он, пусть имеет (прозвище)\nда это россия, не испания хуйня да сука хватит забивать на сервер два тупых уёбка\nвас маршаффер прогревает видосами по штахникистану, а вы ему ни премии, ни випки вы ебланы\nя просто не успеваю вас таджичить как колджик да я же просто вас взъебу вы только дайте мне аджи-\nда я хуярю успеваю вас ебать и так по кругу, сука лондон и кодер вы только ходите по кругу (суки)\n\n[Autro]\nВот ты знаешь? Русский Дрифт Сервер это такая параша ебаная, я просто в шоке как маршафер оттуда не ливнул, понимаешь?\nЯ бы уже давно просто нарванил там и съебал будто этого сервера и не было"
        },
        {
            "id": 2,
            "title": "ташкент",
            "artist": "эмси б4мжиха",
            "duration": "1:33",
            "audio": "ташкент.mp3",
            "lyrics": "[Intro]\nа? а? а? а? а? а? а? а?\n\n[Verse]\nСосиски типо сос а сос это сосать\nно даже так же мы не можем послать нахуй эту зять\nда я ташкент да я гашиш но не имеем эту свищ\nbecause i dropped out bomb a basic\nсука ловит пакет пейзер\nЕ, меня недооценили когда я вмазал весь сервер а потом мне и сосили(типо сосиски)\nя вьебал медлечок тупо под россию и на мне же нету зэтки так как нахуй всю россию блять(нахуй)\nчушка роется кувалдой на моем бля еблете, но даже так она не найдет той инфы что ищут РОСповеди\nгашенный ташкент это тот кто имеет власть но я же ебу только их и меня знает лор киспасть(ЧЕ БЛЯ?)\n\n[Break]\nБуд-буд-буд-буд-буд-буд-буд-\n\n[Verse 2]\nБуду трахать и ебашить это вечность\nв то же время как забрал у тя одежду\nты же просто можешь сосать\nно ташкентам это просто бля не надо\nто призвание ВИВИАР на мне не носят джинсы...\nприготовь поливку...\nразьебем сигу.. но в то же время как носили жидкость.....\n\n[Verse 3]\nСосиски типо сос а сос это сосать\nно даже так же мы не можем послать нахуй эту зять\nда я ташкент да я гашиш но не имеем эту свищ\nbecause i dropped out bomb a basic\nсука ловит пакет пейзер\nЕ, меня недооценили когда я вмазал весь сервер а потом мне и сосили(типо сосиски)\nя вьебал медлечок тупо под россию и на мне же нету зэтки так как нахуй всю россию блять(нахуй)\nчушка роется кувалдой на моем бля еблете, но даже так она не найдет той инфы что ищут РОСповеди\nгашенный ташкент это тот кто имеет власть но я же ебу только их и меня знает лор киспасть(ЧЕ БЛЯ?)\n\n[Autro]\nа? а? а? а? а? а? а? а? альбом эмси бомжихи(four)"
        },
        {
            "id": 3,
            "title": "морж дисс (ft. эмси чума)",
            "artist": "эмси б4мжиха, эмси чума",
            "duration": "2:31",
            "audio": "morjik diss.mp3",
            "lyrics": "[Intro]\nХэй! Ха-ха, мне ща звонил маршаффер и сказал что какой-то морж хуекрож, я хз че за нн но сказал что трек моего брата эмси бомжа\nхуйня, походу придется задиссить эту собачку ёбанную а то хули пиздит?\n\n[Verse]\nгашенный ташкент но не имеет блять пельменей\nнегр черный красит икру будто бы он еба владелец\nзахуярил трех подростков позовите бля гитару\nведь мы уже хуярим, хуесосим его маму\nда мы гитлер и шалава и ебучий наркоман\nда мы ебем столько сколько и не видел бля дурман\nу нас тут тюлень морж и пенсия в ебучем невермаге\nда мы будем трахать жоска сервер с пивом и носками\nнегр черный пидорас, но мы не хаваем его маму\nвместо этого ебемся будто нам ща нужно нала\nна стероидах сука пляшет будто видет говноеда, но во время шлюхи пениса не видим мы проводку! (ГАНЬГ)\nЧушка пляшет голая как будто бы вагина...\n(у моржика не видно видимо тоже вагина, СУКА!)\n\n[Verse 2]\nНе могу остановиться будто хлещет ща пиздец\nи как пиздела мэс тамара похоронил отец\nда я ебу ща дед мороза меня жахает пиздец\nи я же также дцпшник нахуя мне здесь омлет???\nморжик пидор!\nсука че за рдс?\nя стилю тут лучший рэп что не видовал мой отец\nда сука я нейронка да сука не человек\nно даже ты пидор ебанный хуже чем мой сука стеееейк!\nШат клоун ага, сука ебанный дрочи но как же ты сука еблан ты че же так не замолчишь\nя тя пизжу как будто негра пидораса на мангвэйне\nгашенный ташкент... кодер лондон это пидоры\nсосут детей как будто они не в россии блять\nих же просто свяжут отъебут бля ИИИ выселят\nа я буду пиво пить как будто я не цивик ща\n\n[Verse 3]\nгашенный ташкент но не имеет блять пельменей\nнегр черный красит икру будто бы он еба владелец\nзахуярил трех подростков позовите бля гитару\nведь мы уже хуярим, хуесосим его маму\nда мы гитлер и шалава и ебучий наркоман\nда мы ебем столько сколько и не видел бля дурман\nу нас тут тюлень морж и пенсия в ебучем невермаге\nда мы будем трахать жоска сервер с пивом и носками\nнегр черный пидорас, но мы не хаваем его маму\nвместо этого ебемся будто нам ща нужно нала\nна стероидах сука пляшет будто видет говноеда, но во время шлюхи пениса не видим мы проводку! (ГАНЬГ)\nЧушка пляшет голая как будто бы вагина...\n(у моржика не видно видимо тоже вагина, СУКА!)\n\n[Autro-Phone Call]\nРазъебал этих пидорасов, если что звони маршаффер!\nРасхуярим их тут все вместо бандой албанрэкордс!\n-Хорошо."
        },
        {
            "id": 4,
            "title": "чушка (ft. эмси чума)",
            "artist": "эмси б4мжиха, эмси чума",
            "duration": "1:00",
            "audio": "чушка.mp3",
            "lyrics": "[Intro]\nБудто ты сосешь но не сосешь это правда\nда на меня сломила жизнь - это не правда\nгашиш на мне стоит как вся твоя жизнь это правда\nа то что ухо на тебе висит - это не правда\n\n[Verse]\nвижу я литосика\nпойду на чередосика\nгашиша на мне мало я позвоню твоему боссику\nя не видел тех кто может сосать за бакс\nно твой рот и твой глаз походу тех кого надо взяяяяяяяяя-\nСЕКС оу да гашенный пидар(ГАААШ)\nя не знаю в какой гроб я ща загнал сам себя(GOD)\nу меня сука стоит как наркоман эта бич сосет буквально когда ей давать в ротан(ДЭМН!?)\n\n[Break]\n\n[Verse 2]\nРуська\nсуська\nбичка\nчушка\nшлюшка\nписька\nнахуй тебя пида-\nРуська\nсуська\nбичка\nчушка\nшлюшка\nписька\nнахуй тебя пидар"
        },
        {
            "id": 5,
            "title": "арбитражник",
            "artist": "эмси б4мжиха",
            "duration": "1:46",
            "audio": "арбитражник.mp3",
            "lyrics": "[Verse]\nтанцую будто арбитражник на мне сел электровлажный\nсАкаю будто гашен-\nна мне нету падших. потому что здох как лажный.\nкаждый перец в трубе свэга будто я не знаю нежить (ПАША)\n\n[Break]\nСАкаю будто газ, аз-аз-аз-аз-аз-аз-аз\nБудто газ, аз-аз-аз-аз-аз-аз\nБудто сващ, ащ-ащ-ащ-ащ-ащ-ащ\nНереал, блэ-блэ-блэ-блэ-блэ-блэ\nГенитал!\n\n[Verse 3]\nтанцую будто арбитражник на мне сел электровлажный\nсАкаю будто гашен-\nна мне нету падших. потому что здох как лажный.\nкаждый перец в трубе свэга будто я не знаю нежить (ПАША)\nтанцую будто арбитражник на мне сел электровлажный\nсАкаю будто гашен-\nна мне нету падших. потому что здох как лажный.\nкаждый перец в трубе свэга будто я не знаю нежить (ПАША)\nПельмени это свято, верят духи каленвала\nЧурка знает цель но не знает его ни мама\nЯ только варю лютый свэг и мне не нужен деньги\n(не нужен деньги, блэ-)"
        },
        {
            "id": 6,
            "title": "тюрьма (feat. Wuro)",
            "artist": "эмси б4мжиха, Wuro",
            "duration": "2:11",
            "audio": "побег.mp3",
            "lyrics": "[Intro]\nя сбежал из тюрьмы...\nя не знаю кто же мы,\nда то что я сбежал с тюрьмы\nна мне и нету похвалы\nда я сбежал из тюрьмы...\nя не знаю кто же мы,\nда то что я сбежал с тюрьмы\nна мне и нету похвалы\nда я хочу же все опять, да кто же был ты был не зять\nда я гашенный будто стать...\n\n[Verse]\nя сбежал из тюрьмы...\nя не знаю кто же мы,\nда то что я сбежал с тюрьмы\nна мне и нету похвалы\nда я сбежал из тюрьмы...\nя не знаю кто же мы,\nда то что я сбежал с тюрьмы\nна мне и нету похвалы\nда я хочу же все опять, да кто же был ты был не зять\nда я гашенный будто стать...\n\n[Verse 2]\nНавалю тарпеды (Е!)...\nМне не скажут что я первый(Да)...\nЯ лишь терпеливый не***(Воу)...\nМеня ищут левые.. меня ищут (ДА, сука)\n\n[Verse 3]\nя сбежал из тюрьмы...\nя не знаю кто же мы,\nда то что я сбежал с тюрьмы\nна мне и нету похвалы\nда я сбежал из тюрьмы...\nя не знаю кто же мы,\nда то что я сбежал с тюрьмы\nна мне и нету похвалы\nда я хочу же все опять, да кто же был ты был не зять\nда я гашенный будто стать...\nя сбежал из тюрьмы...\nя не знаю кто же мы,\nда то что я сбежал с тюрьмы\nна мне и нету похвалы\nда я сбежал из тюрьмы...\nя не знаю кто же мы,\nда то что я сбежал с тюрьмы\nна мне и нету похвалы\nда я хочу же все опять, да кто же был ты был не зять\nда я гашенный будто стать...\n\n[Autro break]"
        }
    ]
};

const config2 = {
    "album": {
        "title": "NADEZHDA 2026",
        "artist": "эмси б4мжиха",
        "year": "2026",
        "genre": "Хип-Хоп / Rap",
        "cover": "oblojka2.jpg",
        "description": "Второй альбом созданный эмси б4мжихой. Тут наш AI рэпер решил выдать интересное *космическое* звучание. Заряжайте свои космо-лёты и погнали!"
    },
    "tracks": [
        {
            "id": 1,
            "title": "Попа 2 (ft. райский стриптизёр)",
            "artist": "эмси б4мжиха, райский стриптизёр",
            "duration": "1:41",
            "audio": "попа 2.mp3",
            "lyrics": "[Intro]\nАй!\nАй!\nАй!\n\n[Verse]\nЛондон сука не припаркованный, он город(сука)\nУ меня такой водила что не позаботится о нашем корпоративе, кодер слушает дебила (Бич)\nчтобы не случилось я хочу тебя увидеть, пиво!!! (алкаш)\nЕсли тебе не понравился глубокий басс, то ты пидорас! (Гей)\nТвоя девушка не хочет быть как под навозом\nей руководит говно-поносом(БЛЯТЬ!)\nЧурка мне привод приносит но она не носа-носилка (Сука!)\nя выполнил ща заказы но я не курьер  а насильник (ЕБАТЬ!?)\nБургеры ем только если нужны мне битмейкеры,\nно я ща не съел нихуя тогда нахуя мне битмеэуу---\n...\nСука я дебил, да немощь, ебучий концертмейстер. (КОНЦЕРТ)\nмне писал этот текст маршаф- (БЛЯТЬ, нахуй палю?)\nесли на мне утюг (Ей!)\n\n[Chill]\n\n[Verse 2]\nЧтобы не случилось я залью ебло кишечником\nДа сука я убийца но не для тебя же бейби(трахайся)\nЯ курю столько дерьма почему я не маршаффер(Почему?)\nЯ ебу всю рэп-тусовку позовите гучимейна(Носки)\nЯ не знаю ритм, ведь мне пишут бит без пепси(Пидор)\nСука я дебил, да немощь, ебучий концертмейстер. (КОНЦЕРТ)\nмне писал этот текст маршаф- (БЛЯТЬ, нахуй палю?)\nесли на мне утюг (Ей!)\n\n[Autro]\nИ я не понял блять какого хуя кончился бит.\nАйс!\nАйс!\nАйс!\n(Э-э-эмси бомжиха...)"
        },
        {
            "id": 2,
            "title": "Черным быть круто, Ч.1 (VVR)",
            "artist": "эмси б4мжиха",
            "duration": "2:16",
            "audio": "(vvr).mp3",
            "lyrics": "[Intro]\nЭЙ! уооооооу\nуооооу\nуааааа-\nДа! ДА! нет...\n\n[Verse 1]\nЯ сплевал гашишем\nя придумал прикол, да когда я лечу так здохну что же это за прикол?\nЯ не знаю кто придумал что быть черным не круто\nкогда как только я пришел все черные, блять это круто!\n\n[Verse 2]\nПомолись, пока я захавал высь! (ау-ау-ау-ау)\nМеня раздовило этой крышкой..(сука)\nСука, на меня напала шлюха..(Эй)\nЭй, эй\nНо она не знает кто же скурил эту блядь, точно(сука)\nАЙ\n\n[Verse 3]\nЯ сплевал гашишем\nя придумал прикол, да когда я лечу так здохну что же это за прикол?\nЯ не знаю кто придумал что быть черным не круто\nкогда как только я пришел все черные, блять это круто!\nУ МЕНЯ НА ТАЧКЕ ща написано подруг бля (дохуища)\nно и быть рэпером так хуево, дайте мне пожить еще (Блять)\n\n[Autro]\nСука, сука (ай-ай-ай)\nСука\nШлюха!\nБЛЯДЬ!\n\n[Part 2]\n\n[Intro]\nЯ не зна-аю что со мно-о-ой\nКогда меня зовут домой, не знаю что сказать\nно сегодня мне не скать.\n\n[Verse]\nВивиа-а-а-р...\nВивиа-а-а-р...\nВивиа-а-а-р...\nЗнаю какого быть мне ща лиминал\nВивиа-а-а-р...\nВивиа-а-а-р...\nВивиа-а-а-р...\nЯ не знаю кто мне подложил пидора-\n\n[Autro]\nЯ не зна-аю что со мно-о-ой\nКогда меня зовут домой, не знаю что сказать\nно сегодня мне не скать."
        },
        {
            "id": 3,
            "title": "Sex v1llage (ft. mzlff)",
            "artist": "эмси б4мжиха, mzlff",
            "duration": "2:09",
            "audio": "sex village.mp3",
            "lyrics": "[Intro]\nТыгдык\nТыгдык\nТыгдык\nКто там?\n\n[Verse 1]\nБич на вафле шлюха\nя кручу на носу бомбу\n\nя как будто вилла на меня летит мудила\nсука хочет получить в нос\nно перед тобой эмси насос\nэмси бомжа мы отъебали сказал эмси гандон ебаный\nя пытаюсь нахуярить вермишель сосались люди с ебенень\nэто самый странный мой альбом\nдержите с ебнутой насос\nОтдохните!\n\n[Break]\n\n[Verse 2]\nБич на вафле шлюха\nя кручу на носу бомбу\n\nя как будто вилла на меня летит мудила\nсука хочет получить в нос\nно перед тобой эмси насос\nэмси бомжа мы отъебали сказал эмси гандон ебаный\nя пытаюсь нахуярить вермишель сосались люди с ебенень\nэто самый странный мой альбом\nдержите с ебнутой насос\nбич гашиша не губой\nтрахаю ее пиздой\nно как же так ведь я не голубой\nблять ее ебут ногой\nно это секс деревня меня не волнует рыбой\nгашенный ташкент это маршаффер и лекрой...\n\n[Break 2]\nАбонент временно недоступен!\n\n[Verse 3]\nБич на вафле шлюха\nя кручу на носу бомбу\n\nя как будто вилла на меня летит мудила\nсука хочет получить в нос\nно перед тобой эмси насос\nэмси бомжа мы отъебали сказал эмси гандон ебаный\nя пытаюсь нахуярить вермишель сосались люди с ебенень\nэто самый странный мой альбом\nдержите с ебнутой насос\nбич гашиша не губой\nтрахаю ее пиздой\nно как же так ведь я не голубой\nблять ее ебут ногой\nно это секс деревня меня не волнует рыбой\nгашенный ташкент это маршаффер и лекрой...\n\n[Autro]\nsex village, эмси б4мжиха\nvaflya"
        },
        {
            "id": 4,
            "title": "эмси б4мжиха",
            "artist": "эмси б4мжиха",
            "duration": "1:13",
            "audio": "эмси б4мжиха.mp3",
            "lyrics": "[Intro]\nSS\n\n[Verse]\nЭмси бомжиха! Свэщ. эщ, ащ Блять\nЭмси бомжиха - свэг, дост и жжение\nбасс. на. мне это сила\nсука хватит своего животного ща насилова-\nя горю! У-у-ууууу!\nЯ ебу-у-ууууу\nЭмси бомжиха! Свэщ. эщ, ащ Блять\nЭмси бомжиха - свэг, дост и жжение\nбасс. на. мне это сила\nсука хватит своего животного ща насилова-\nя горю! У-у-ууууу!\nЯ ебу-у-ууууу\n\n[Verse 2]\nЯ не знаю че придумать это рэп альбом (ряльна)\nу меня нет целей думать что у вас мозги ебальные (ебать)\nкодер с рукожопом лондоном ебут детей (ЦЭПЭшники)\nГАНДОН сосет лишь ломом дайте ему в ебл-\nGO-O-OD SYSTEM-\nGO-O-OD SYSTEM-\nGO-O-OD SYSTEM-\nGO-O-OD SYSTEM.\nsystem.\n\n[Autro]\nАщ-\nАщ-\nАщ-\nАщ-\nАщ-\nАщ-\nАщ-\nАщ-\nАщ-\nАщ-\nАщ-\nАщ-\n[Beat ended]\nЭмси бомжиха и эмси чума блять."
        }
    ]
};

// Массив всех альбомов
const albumsData = [
    {
        album: config1.album,
        tracks: config1.tracks
    },
    {
        album: config2.album,
        tracks: config2.tracks
    }
];

let currentAlbumData = null; // Текущий выбранный альбом (объект из albumsData)
let currentTrackIndex = 0;
let isPlaying = false;
let repeatMode = false;
let shuffleMode = false;
let isMuted = false;
let previousVolume = 0.7;
const audio = new Audio();
let visualizerCtx = null;

// Инициализация
function init() {
    renderHomePage();
    setupAudioEvents();
    audio.volume = 0.7;
    setupVisualizer();
    
    // Создаем частицы в фон
    createParticles();
}

// Создание частиц фона
function createParticles() {
    const container = document.querySelector('.particles-container');
    for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.style.position = 'absolute';
        particle.style.width = Math.random() * 4 + 1 + 'px';
        particle.style.height = particle.style.width;
        particle.style.background = 'rgba(157, 78, 221, 0.3)';
        particle.style.borderRadius = '50%';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.boxShadow = '0 0 10px rgba(157, 78, 221, 0.5)';
        particle.style.animation = `float ${Math.random() * 20 + 10}s infinite ease-in-out`;
        particle.style.animationDelay = Math.random() * 5 + 's';
        container.appendChild(particle);
    }
}

// Настройка визуализатора
function setupVisualizer() {
    const canvas = document.getElementById('visualizer');
    if (!canvas) return;
    
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    visualizerCtx = canvas.getContext('2d');
    
    // Создаем фейковый аудиоконтекст для визуализатора
    setInterval(drawVisualizer, 100);
}

// Отрисовка визуализатора
function drawVisualizer() {
    if (!visualizerCtx) return;
    
    const canvas = document.getElementById('visualizer');
    const ctx = visualizerCtx;
    const width = canvas.width;
    const height = canvas.height;
    
    // Очищаем канвас
    ctx.clearRect(0, 0, width, height);
    
    if (!isPlaying) return;
    
    // Создаем градиент
    const gradient = ctx.createLinearGradient(0, 0, width, 0);
    gradient.addColorStop(0, 'rgba(157, 78, 221, 0)');
    gradient.addColorStop(0.5, 'rgba(157, 78, 221, 0.3)');
    gradient.addColorStop(1, 'rgba(157, 78, 221, 0)');
    
    ctx.fillStyle = gradient;
    
    // Рисуем волны
    const time = Date.now() / 1000;
    const barCount = 80;
    const barWidth = width / barCount;
    
    for (let i = 0; i < barCount; i++) {
        const x = i * barWidth;
        // Используем синусоидальную функцию для создания волн
        const amplitude = Math.sin(time * 2 + i * 0.2) * 0.5 + 0.5;
        const barHeight = (amplitude * height * 0.6) + height * 0.2;
        
        ctx.fillRect(x, height - barHeight, barWidth - 1, barHeight);
    }
}

// Рендер главной страницы
function renderHomePage() {
    const grid = document.getElementById('album-grid');
    grid.innerHTML = '';
    
    albumsData.forEach(albumData => {
        const card = document.createElement('div');
        card.className = 'album-card';
        card.innerHTML = `
            <img src="${albumData.album.cover}" alt="${albumData.album.title}" class="album-cover" onclick="openAlbum('${albumData.album.title}')">
            <h3 class="album-title">${albumData.album.title}</h3>
            <p class="album-artist">${albumData.album.artist}</p>
            <p class="album-year">${albumData.album.year}</p>
        `;
        grid.appendChild(card);
    });
}

// Открыть страницу альбома
function openAlbum(title) {
    currentAlbumData = albumsData.find(a => a.album.title === title);
    if (!currentAlbumData) return;
    
    document.getElementById('home-page').style.display = 'none';
    const albumPage = document.getElementById('album-page');
    albumPage.style.display = 'block';
    
    // Заполняем данные альбома
    document.getElementById('album-page-title').textContent = currentAlbumData.album.title;
    document.getElementById('album-page-artist').textContent = currentAlbumData.album.artist;
    document.getElementById('album-page-year').textContent = currentAlbumData.album.year;
    document.getElementById('album-page-genre').textContent = currentAlbumData.album.genre;
    document.getElementById('album-page-desc').textContent = currentAlbumData.album.description;
    document.getElementById('album-cover-large').src = currentAlbumData.album.cover;
    document.getElementById('album-cover-large').onclick = () => openZoom(currentAlbumData.album.cover);
    document.getElementById('album-tracks-count').textContent = currentAlbumData.tracks.length;
    
    // Обновляем обложку в плеере
    document.getElementById('current-cover').src = currentAlbumData.album.cover;
    
    // Считаем общую длительность альбома
    calculateAlbumDuration(currentAlbumData.tracks);
    
    // Рендерим треки
    const tracksList = document.getElementById('tracks-list');
    tracksList.innerHTML = '';
    
    currentAlbumData.tracks.forEach((track, index) => {
        const item = document.createElement('div');
        item.className = 'track-item';
        item.onclick = () => playTrack(index);
        item.innerHTML = `
            <div class="track-number">${track.id}</div>
            <div class="track-details">
                <div class="track-title">${track.title}</div>
                <div class="track-artist">${track.artist}</div>
            </div>
            <div class="track-duration">${track.duration}</div>
        `;
        tracksList.appendChild(item);
    });
    
    // Прокручиваем к началу
    window.scrollTo(0, 0);
}

// Вернуться назад
function goBack() {
    document.getElementById('album-page').style.display = 'none';
    document.getElementById('home-page').style.display = 'block';
    currentAlbumData = null;
}

// Воспроизвести весь альбом
function playAlbum() {
    playTrack(0);
}

// Воспроизвести трек
function playTrack(index) {
    if (!currentAlbumData) return;
    
    currentTrackIndex = index;
    const track = currentAlbumData.tracks[index];
    
    audio.src = track.audio;
    audio.play();
    isPlaying = true;
    document.getElementById('play-icon').className = 'fas fa-pause';
    
    // Обновляем UI
    document.getElementById('current-title').textContent = track.title;
    document.getElementById('current-artist').textContent = track.artist;
    document.getElementById('current-cover').src = currentAlbumData.album.cover;
    
    // Подсвечиваем активный трек
    document.querySelectorAll('.track-item').forEach((item, i) => {
        item.classList.toggle('active', i === index);
    });
    
    // Обновляем время в плеере
    updateTimeDisplay();
}

// Управление воспроизведением
function togglePlay() {
    if (!audio.src || !currentAlbumData) {
        if (currentAlbumData) {
            playTrack(0);
        }
        return;
    }
    
    if (isPlaying) {
        audio.pause();
        document.getElementById('play-icon').className = 'fas fa-play';
    } else {
        audio.play();
        document.getElementById('play-icon').className = 'fas fa-pause';
    }
    isPlaying = !isPlaying;
}

function nextTrack() {
    if (!currentAlbumData) return;
    
    let nextIndex;
    if (shuffleMode) {
        nextIndex = getRandomTrackIndex();
    } else {
        nextIndex = currentTrackIndex + 1;
        if (nextIndex >= currentAlbumData.tracks.length) {
            nextIndex = repeatMode ? 0 : currentTrackIndex;
            if (!repeatMode) {
                isPlaying = false;
                document.getElementById('play-icon').className = 'fas fa-play';
                return;
            }
        }
    }
    playTrack(nextIndex);
}

function prevTrack() {
    if (!currentAlbumData) return;
    
    if (audio.currentTime > 3) {
        audio.currentTime = 0;
        return;
    }
    
    let prevIndex;
    if (shuffleMode) {
        prevIndex = getRandomTrackIndex();
    } else {
        prevIndex = currentTrackIndex - 1;
        if (prevIndex < 0) {
            prevIndex = currentAlbumData.tracks.length - 1;
        }
    }
    playTrack(prevIndex);
}

function getRandomTrackIndex() {
    if (!currentAlbumData) return 0;
    
    let randomIndex;
    do {
        randomIndex = Math.floor(Math.random() * currentAlbumData.tracks.length);
    } while (randomIndex === currentTrackIndex && currentAlbumData.tracks.length > 1);
    return randomIndex;
}

function toggleRepeat() {
    repeatMode = !repeatMode;
    const btn = document.getElementById('repeat-btn');
    btn.classList.toggle('active', repeatMode);
    audio.loop = repeatMode;
}

function toggleShuffle() {
    shuffleMode = !shuffleMode;
    document.getElementById('shuffle-btn').classList.toggle('active', shuffleMode);
}

function toggleMute() {
    isMuted = !isMuted;
    const btn = document.getElementById('volume-btn');
    
    if (isMuted) {
        previousVolume = audio.volume;
        audio.volume = 0;
        document.getElementById('volume-slider').value = 0;
        btn.innerHTML = '<i class="fas fa-volume-mute"></i>';
    } else {
        audio.volume = previousVolume;
        document.getElementById('volume-slider').value = previousVolume * 100;
        updateVolumeIcon(previousVolume);
    }
}

function changeVolume(value) {
    const volume = value / 100;
    audio.volume = volume;
    previousVolume = volume;
    isMuted = volume === 0;
    
    updateVolumeIcon(volume);
    
    const btn = document.getElementById('volume-btn');
    if (volume === 0) {
        btn.innerHTML = '<i class="fas fa-volume-mute"></i>';
    } else {
        btn.classList.remove('active');
    }
}

function updateVolumeIcon(volume) {
    const btn = document.getElementById('volume-btn');
    if (volume === 0) {
        btn.innerHTML = '<i class="fas fa-volume-mute"></i>';
    } else if (volume < 0.5) {
        btn.innerHTML = '<i class="fas fa-volume-down"></i>';
    } else {
        btn.innerHTML = '<i class="fas fa-volume-up"></i>';
    }
}

// Прогресс бар
function seek(e) {
    if (!audio.duration) return;
    const rect = e.target.getBoundingClientRect();
    const pos = (e.clientX - rect.left) / rect.width;
    audio.currentTime = pos * audio.duration;
}

// Обновление отображения времени
function updateTimeDisplay() {
    const currentTime = document.getElementById('current-time');
    const totalTime = document.getElementById('total-time');
    
    if (audio.duration) {
        currentTime.textContent = formatTime(audio.currentTime);
        totalTime.textContent = formatTime(audio.duration);
    }
}

// События аудио
function setupAudioEvents() {
    audio.addEventListener('timeupdate', () => {
        const progress = document.getElementById('progress');
        const progressGlow = document.querySelector('.player-progress-glow');
        
        if (audio.duration) {
            const percent = (audio.currentTime / audio.duration) * 100;
            progress.style.width = `${percent}%`;
            progressGlow.style.transform = `translateX(${percent}%)`;
            
            updateTimeDisplay();
        }
    });
    
    audio.addEventListener('ended', () => {
        if (!repeatMode) {
            nextTrack();
        }
    });
    
    audio.addEventListener('loadedmetadata', () => {
        updateTimeDisplay();
    });
}

function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
}

// Подсчет общей длительности альбома
function calculateAlbumDuration(tracks) {
    let totalSeconds = 0;
    
    tracks.forEach(track => {
        const parts = track.duration.split(':');
        if (parts.length === 2) {
            totalSeconds += parseInt(parts[0]) * 60 + parseInt(parts[1]);
        }
    });
    
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    document.getElementById('album-total-duration').textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    document.getElementById('album-page-duration').textContent = `${minutes} мин ${seconds} сек`;
}

// Текст песни
function showLyrics() {
    if (!currentAlbumData) return;
    
    const track = currentAlbumData.tracks[currentTrackIndex];
    if (!track || !track.lyrics) return;
    
    document.getElementById('lyrics-title').textContent = `${track.title} · ${track.artist}`;
    document.getElementById('lyrics-text').textContent = track.lyrics;
    document.getElementById('lyrics-modal').style.display = 'flex';
    
    // Блокируем прокрутку фона
    document.body.style.overflow = 'hidden';
}

function closeLyrics() {
    document.getElementById('lyrics-modal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Увеличение обложки
function openZoom(src) {
    document.getElementById('zoomed-cover').src = src;
    document.getElementById('zoom-modal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeZoom() {
    document.getElementById('zoom-modal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Инициализация при загрузке
window.onload = init;

// Обработка изменения размера окна
window.onresize = () => {
    const canvas = document.getElementById('visualizer');
    if (canvas) {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
    }
};